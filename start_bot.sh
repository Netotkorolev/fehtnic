#!/bin/bash

# Скрипт безопасного запуска бота ФехтНик
# Убивает все работающие процессы бота перед запуском нового

echo "🔍 Поиск запущенных процессов бота..."

# Находим все процессы python3 bot.py и python bot.py
pids=$(ps aux | grep -E "python[3]? bot.py" | grep -v grep | awk '{print $2}')

if [ -z "$pids" ]; then
    echo "✅ Старые процессы бота не найдены"
else
    echo "🛑 Найдены старые процессы бота: $pids"
    echo "⚠️  Останавливаем старые процессы..."
    
    # Убиваем найденные процессы
    for pid in $pids; do
        kill -9 $pid 2>/dev/null
        echo "   ✓ Процесс $pid остановлен"
    done
    
    sleep 2
    echo "✅ Все старые процессы остановлены"
    echo "⏳ Ожидание освобождения Telegram API (10 секунд)..."
    sleep 10
fi

# Переходим в директорию бота
cd "$(dirname "$0")"

echo ""
echo "🚀 Запуск бота ФехтНик..."
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

# Запускаем бота
python3 bot.py

